angular.module("app").controller("appController",["$scope","urlParamService","remoteFileService",function(b,e,a){b.selectedRecording=null;b.playing=!1;b.error=!1;b.errorMessage=null;b.remoteMode=!1;b.downloading=!1;b.$on("glenPlayerLoading",function(){b.error=!1;b.errorMessage=null});b.$on("glenPlayerError",function(a,c){b.selectedRecording=null;b.error=!0;b.errorMessage=c||"An error occurred while loading the recording."});b.$on("glenPlayerPlay",function(){b.playing=!0});b.$on("glenPlayerPause",
function(){b.playing=!1});(function(){if(e.isPath("/remote")){b.remoteMode=!0;var k=e.getParam("url");k?(b.downloading=!0,a.downloadFile(k).then(function(a){b.selectedRecording=a;b.downloading=!1}).catch(function(a){b.error=!0;b.errorMessage=a;b.downloading=!1;console.error("Remote file download error:",a)})):(b.error=!0,b.errorMessage="No URL specified. Use /remote?url\x3d\x3curl\x3e to specify a remote recording.")}else b.remoteMode=!1})()}]);
angular.module("app",["file","player","templates-main","ngRoute"]).config(["$locationProvider","$routeProvider",function(b,e){b.html5Mode(!0);e.when("/",{template:""}).when("/remote",{template:""}).otherwise({redirectTo:"/"})}]);
angular.module("file").directive("glenFileChooser",[function(){return{restrict:"E",templateUrl:"modules/file/templates/fileChooser.html",transclude:!0,scope:{file:"\x3d"},controller:["$scope","$element",function(b,e){e.find('input[type\x3d"file"]').on("change",function(){var a=this.files;1===a.length&&b.$apply(function(){b.file=a[0]})})}]}}]);angular.module("file",["templates-main"]);
angular.module("player").directive("glenPlayer",["$injector",function(b){var e=b.get("SessionRecording");return{restrict:"E",templateUrl:"modules/player/templates/player.html",scope:{blob:"\x3d"},controller:["$scope","$element","$injector",function(a){a.recording=null;a.playbackPosition=0;a.operationText=null;a.operationProgress=0;a.seekPosition=null;var b=!1,c=!1;a.formatTime=function(a){a=Math.floor((a||0)/1E3);for(var b=[1,24,60,60],c=b.length-1;0<=c;c--){var d=b[c],e=a%d;b[c]=9<e?e:"0"+e;a=Math.floor(a/
d)}a=b.join(":");return/^[0:]*([0-9]{1,2}(?::[0-9]{2})+)$/.exec(a)[1]};a.beginSeekRequest=function(){a.recording&&!b&&(c=a.recording.isPlaying(),a.recording.pause());b=!0};a.commitSeekRequest=function(){a.recording&&b&&(a.seekPosition=null,a.operationText="Seeking to the requested position. Please wait...",a.operationProgress=0,a.cancelOperation=function(){a.recording.cancel();a.playbackPosition=a.seekPosition||a.playbackPosition},c&&a.recording.play(),a.recording.seek(a.playbackPosition,function(){a.operationText=
null;a.$evalAsync()}));b=!1};a.togglePlayback=function(){a.recording&&(a.recording.isPlaying()?a.recording.pause():a.recording.play())};a.$watch("blob",function(c){b=!1;a.playbackPosition=0;a.recording&&(a.recording.pause(),a.recording.abort());c?(a.recording=new e(c),a.recording.onload=function(){a.operationText=null;a.$emit("glenPlayerLoaded");a.$evalAsync()},a.recording.onerror=function(b){a.operationText=null;a.$emit("glenPlayerError",b);a.$evalAsync()},a.recording.onprogress=function(b,d){a.operationProgress=
d/c.size;a.$emit("glenPlayerProgress",b,d);a.$evalAsync()},a.recording.onplay=function(){a.$emit("glenPlayerPlay");a.$evalAsync()},a.recording.onpause=function(){a.$emit("glenPlayerPause");a.$evalAsync()},a.recording.onseek=function(b,c,d){a.recording.isPlaying()?a.playbackPosition=b:(a.seekPosition=b,a.operationProgress=c/d);a.$emit("glenPlayerSeek",b);a.$evalAsync()},a.operationText="Your recording is now being loaded. Please wait...",a.operationProgress=0,a.cancelOperation=function(){a.recording.abort();
a.operationText=null},a.$emit("glenPlayerLoading")):a.recording=null})}]}}]);
angular.module("player").directive("glenPlayerDisplay",[function(){return{restrict:"E",templateUrl:"modules/player/templates/playerDisplay.html",scope:{display:"\x3d"},controller:["$scope","$element",function(b,e){var a=e[0],k=e.find(".guac-player-display-container")[0],c=e.find(".glen-resize-sensor")[0],d=function(){if(b.display){var c=b.display.getWidth(),d=b.display.getHeight();c&&d&&b.display.scale(Math.min(a.offsetWidth/c,a.offsetHeight/d))}};b.$watch("display",function(a,b){b&&(k.innerHTML=
"",b.onresize=null);a&&(k.appendChild(a.getElement()),a.onresize=d,d())});c.onload=function(){c.contentDocument.defaultView.addEventListener("resize",d);d()}}]}}]);angular.module("player",["templates-main"]);
angular.module("player").directive("glenPlayerProgressIndicator",[function(){return{restrict:"E",templateUrl:"modules/player/templates/progressIndicator.html",scope:{progress:"\x3d"},controller:["$scope",function(b){b.percentage=0;b.barTransform=null;b.$watch("progress",function(e){e=e||0;b.percentage=Math.floor(100*e);b.barTransform="rotate("+(360*e-45)+"deg)"})}]}}]);
angular.module("file").factory("remoteFileService",["$http","$q",function(b,e){var a={},k=function(a){if(/^[A-Za-z0-9+/=]+$/.test(a))try{return atob(a)}catch(d){}return a};a.downloadFile=function(a){var c=e.defer(),g=k(a);b.get(g,{responseType:"blob"}).then(function(a){var b=g.substring(g.lastIndexOf("/")+1);a=new Blob([a.data],{type:a.data.type});a.name=b||"recording.guac";c.resolve(a)}).catch(function(a){if(0===a.status)a='CORS Error: Unable to access the remote file due to browser security restrictions. The server hosting the recording must include the "Access-Control-Allow-Origin" header. URL: '+
g;else switch(a.status){case 404:a="File Not Found (404): The requested recording could not be found at URL: "+g;break;case 403:a="Access Denied (403): You do not have permission to access this recording at URL: "+g;break;case 401:a="Authentication Required (401): You need to authenticate to access this recording at URL: "+g;break;case 500:a="Server Error (500): The server encountered an error while processing your request for URL: "+g;break;case -1:a="Network Error: Unable to connect to the server. The server may be down or the URL may be invalid: "+
g;break;default:a="Failed to download file (Status "+a.status+"): "+(a.statusText||"Unknown error")+" - URL: "+g}console.error("Remote file download error:",a);c.reject(a)});return c.promise};return a}]);
angular.module("player").factory("SessionRecording",[function(){var b=function a(b){var c=this,d=[],g=0,k=new a._PlaybackTunnel,p=new Guacamole.Client(k),l=-1,r=null,w=null,t=null,y=0,n=0,u=!1,q=null,A=function(a,d,m){if(!u||a!==b){var z=new Guacamole.Parser;z.oninstruction=d;var f=0,h=new FileReader;d=function(){if(!u||a!==b){if(2===h.readyState)try{z.receive(h.result)}catch(D){if(c.onerror)c.onerror(D.message);return}if(f>=a.size)m&&m();else{var d=a.slice(f,f+262144);f+=d.size;h.readAsText(d)}}};
h.onload=d;d()}},B=function(a){a=a.length;for(var b=a+3;10<=a;)b++,a=Math.floor(a/10);return b};p.connect();p.getDisplay().showCursor(!1);A(b,function(b,f){n+=B(b);for(var m=0;m<f.length;m++)n+=B(f[m]);if("sync"===b){b=parseInt(f[0]);f=new a._Frame(b,y,n);d.push(f);y=n;if(1===d.length||16384<=n-d[g].start&&5E3<=b-d[g].timestamp)f.keyframe=!0,g=d.length-1;if(c.onprogress)c.onprogress(c.getDuration(),n)}},function(){if(c.onload)c.onload()});var v=function(a){return 0===d.length?0:a-d[0].timestamp},
E=function f(a,b,c){if(a===b)return a;var h=Math.floor((a+b)/2),k=v(d[h].timestamp);return c<k&&h>a?f(a,h-1,c):c>k&&h<b?f(h+1,b,c):h},F=function(a,c){var f=d[a];A(b.slice(f.start,f.end),function(a,b){k.receiveInstruction(a,b)},function(){f.keyframe&&!f.clientState&&p.exportState(function(a){f.clientState=a});l=a;c&&c()})},C=function(a,b,k){x();var f=t={aborted:!1},h;for(h=a;0<=h;h--){var g=d[h];if(h===l)break;if(g.clientState){p.importState(g.clientState);l=a;break}}g=function G(){if(c.onseek&&l>
h)c.onseek(v(d[l].timestamp),l-h,a-h);f.aborted||(!f.aborted&&l<a?F(l+1,G):b())};k?window.setTimeout(g,k):g()},x=function(){t&&(t.aborted=!0,t=null)},H=function m(){if(l+1<d.length){var a=Math.max(d[l+1].timestamp-r+w-(new Date).getTime(),0);C(l+1,function(){m()},a)}else c.pause()};this.onseek=this.onpause=this.onplay=this.onprogress=this.onabort=this.onerror=this.onload=null;this.abort=function(){if(!u&&(u=!0,c.onabort))c.onabort()};this.getDisplay=function(){return p.getDisplay()};this.isPlaying=
function(){return!!r};this.getPosition=function(){return-1===l?0:v(d[l].timestamp)};this.getDuration=function(){return 0===d.length?0:v(d[d.length-1].timestamp)};this.play=function(){if(!c.isPlaying()&&l+1<d.length){if(c.onplay)c.onplay();r=d[l+1].timestamp;w=(new Date).getTime();H()}};this.seek=function(a,b){if(0!==d.length){c.cancel();var k=c.isPlaying();c.pause();q=function(){q=null;k&&(c.play(),k=null);b&&b()};C(E(0,d.length-1,a),q)}};this.cancel=function(){q&&(x(),q())};this.pause=function(){x();
if(c.isPlaying()){if(c.onpause)c.onpause();w=r=null}}};b._Frame=function(a,b,c){this.keyframe=!1;this.timestamp=a;this.start=b;this.end=c;this.clientState=null};b._PlaybackTunnel=function(){var a=this;this.connect=function(a){};this.sendMessage=function(a){};this.disconnect=function(){};this.receiveInstruction=function(b,c){if(a.oninstruction)a.oninstruction(b,c)}};return b}]);
angular.module("templates-main",[]).run(["$templateCache",function(b){b.put("modules/file/templates/fileChooser.html",'\x3clabel\x3e\n    \x3cng-transclude\x3e\x3c/ng-transclude\x3e\n    \x3cinput type\x3d"file"\x3e\n\x3c/label\x3e');b.put("modules/player/templates/player.html",'\x3c!-- Actual playback display --\x3e\n\x3cguac-player-display display\x3d"recording.getDisplay()"\n                     ng-click\x3d"togglePlayback()"\x3e\x3c/guac-player-display\x3e\n\n\x3c!-- Player controls --\x3e\n\x3cdiv class\x3d"guac-player-controls" ng-show\x3d"recording"\x3e\n\n    \x3c!-- Playback position slider --\x3e\n    \x3cinput class\x3d"guac-player-seek" type\x3d"range" min\x3d"0" step\x3d"1"\n           ng-attr-max\x3d"{{ recording.getDuration() }}"\n           ng-change\x3d"beginSeekRequest()"\n           ng-model\x3d"playbackPosition"\n           ng-on-change\x3d"commitSeekRequest()"\x3e\n\n    \x3c!-- Play button --\x3e\n    \x3cbutton class\x3d"guac-player-play"\n            title\x3d"Play"\n            ng-click\x3d"recording.play()"\n            ng-hide\x3d"recording.isPlaying()"\x3e\x3ci class\x3d"fas fa-play"\x3e\x3c/i\x3e\x3c/button\x3e\n\n    \x3c!-- Pause button --\x3e\n    \x3cbutton class\x3d"guac-player-pause"\n            title\x3d"Pause"\n            ng-click\x3d"recording.pause()"\n            ng-show\x3d"recording.isPlaying()"\x3e\x3ci class\x3d"fas fa-pause"\x3e\x3c/i\x3e\x3c/button\x3e\n\n    \x3c!-- Playback position and duration --\x3e\n    \x3cspan class\x3d"guac-player-position"\x3e\n        {{ formatTime(playbackPosition) }}\n        /\n        {{ formatTime(recording.getDuration()) }}\n    \x3c/span\x3e\n\n\x3c/div\x3e\n\n\x3c!-- Modal status indicator --\x3e\n\x3cdiv class\x3d"guac-player-status" ng-show\x3d"operationText"\x3e\n    \x3cguac-player-progress-indicator progress\x3d"operationProgress"\x3e\x3c/guac-player-progress-indicator\x3e\n    \x3cp\x3e{{ operationText }}\x3c/p\x3e\n    \x3cbutton class\x3d"guac-player-button" ng-show\x3d"cancelOperation"\n            ng-click\x3d"cancelOperation()"\x3e\x3ci class\x3d"fas fa-stop"\x3e\x3c/i\x3e Cancel\x3c/button\x3e\n\x3c/div\x3e');
b.put("modules/player/templates/playerDisplay.html",'\x3cdiv class\x3d"guac-player-display-container"\x3e\x3c/div\x3e\n\x3cobject class\x3d"glen-resize-sensor" type\x3d"text/html"\n        data\x3d"modules/player/templates/resize-sensor.html"\n        aria-hidden\x3d"true" alt\x3d""\x3e\x3c/object\x3e');b.put("modules/player/templates/progressIndicator.html","\x3cdiv class\x3d\"guac-player-progress-text\"\x3e{{ percentage }}%\x3c/div\x3e\n\x3cdiv class\x3d\"guac-player-progress-bar-container\" ng-class\x3d\"{\n        'past-halfway' : progress \x3e 0.5\n    }\"\x3e\n    \x3cdiv class\x3d\"guac-player-progress-bar\" ng-style\x3d\"{\n        '-webkit-transform' : barTransform,\n        '-moz-transform' : barTransform,\n        '-ms-transform' : barTransform,\n        '-o-transform' : barTransform,\n        'transform' : barTransform\n    }\"\x3e\x3c/div\x3e\n\x3c/div\x3e");
b.put("modules/player/templates/resize-sensor.html",'\x3c!DOCTYPE html\x3e\n\x3chtml lang\x3d"en"\x3e\n    \x3chead\x3e\n        \x3ctitle\x3eApache Guacamole - Session Recording Player (Resize Sensor)\x3c/title\x3e\n        \x3cmeta charset\x3d"utf-8"\x3e\n        \x3cmeta http-equiv\x3d"x-ua-compatible" content\x3d"IE\x3dedge"\x3e\n    \x3c/head\x3e\n    \x3cbody\x3e\x3c!--\n                                                    _/     sw+\n                                                    jm   _yWc\n                               ______.             _QQL  !Q?\n                          _amQQQQQQQQQQQga,        jQQQ, 7   .___,.\n                        _yQQQQQQQQQQQQQQQQQQw,     jQQQg    )QQWT?"\n                       jQQQQQQQQQQQQQQQQQQQQWQg,   ]QQQQm, ~~~-\n                      jQQQQQQQQQQQQQQQQQQQQQQQQQgwmQQQQQQ.., _,\n                     jQQQQQQQQQQQQQQQQQQQQQQQQQQWWP~-$QQQk -?wQga\n                    _QQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ,  4QQQc   ?`?$\n                  .ayQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQm   "4QQ\n                 _yQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQ[    -?(\n              .sjQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQa,__aaaaa,.\n             ayQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWQWWQQQQW?9WQm,\n          _jQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQwyQWQm\n         _yQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQQWQQQQ[\n         --"""^"^-`-` -"??TQWQQQQQQQQQQQQQQQQQQQP?"-~?9$QQQQQQQQQf\n                          .QQQQQQQQQ/  jQQQQQQQQg,         -~~~~-\n                           ^^^^^^^^^^  -^~^~^~^~^`\n    --\x3e\x3c/body\x3e\n\x3c/html\x3e')}]);
angular.module("app").factory("urlParamService",["$location",function(b){return{getParam:function(e){return b.search()[e]||null},isPath:function(e){return b.path()===e}}}]);
//# sourceMappingURL=guac-player.min.js.map